<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>1 level menu (Circle)</title>

    <script src="../../blockly_uncompressed_vertical.js"></script>
    <script src="../../msg/messages.js"></script>
    <script src="../../msg/scratch_msgs.js"></script>
    <script src="../../blocks_vertical/vertical_extensions.js"></script>
    <script src="../../blocks_common/math.js"></script>
    <script src="../../blocks_common/matrix.js"></script>
    <script src="../../blocks_common/note.js"></script>
    <script src="../../blocks_common/text.js"></script>
    <script src="../../blocks_common/colour.js"></script>
    <script src="../../blocks_vertical/control.js"></script>
    <script src="../../blocks_vertical/event.js"></script>
    <script src="../../blocks_vertical/motion.js"></script>
    <script src="../../blocks_vertical/looks.js"></script>
    <script src="../../blocks_vertical/procedures.js"></script>
    <script src="../../blocks_vertical/operators.js"></script>
    <script src="../../blocks_vertical/sound.js"></script>
    <script src="../../blocks_vertical/sensing.js"></script>
    <script src="../../blocks_vertical/data.js"></script>
    <script src="../../blocks_vertical/extensions.js"></script>
    <script src="../../blocks_vertical/default_toolbox.js"></script>
    <script>
      'use strict';

      var workspace = null;

      function start() {
        // Setup blocks
        // Parse the URL arguments.

        // Create main workspace.
        workspace = Blockly.inject('blocklyDiv', {
          media: '../../media/',
          zoom: {
            controls: true,
            wheel: true,
            startScale: 0.675,
            maxScale: 4,
            minScale: 0.25,
            scaleSpeed: 1.1
          },
        });
      }
    </script>

    <style>
      html, body {
        height: 100%;
        margin: 0;
      }

      #blocklyDiv {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>

  <body onload="start()">
    <div id="blocklyDiv"></div>
  </body>

  <script>
    function isCodeBlock(target) { return target.classList[0] == "blocklyDraggable"; }
    function isCategory(target) { return target.classList[0] == "scratchCategoryMenuItem"; }

    // Track element interacted with
    var totalClicks = 0;
    var step = 1;
    var actions = [];
    var lastClickedBlock = "";
    var blocklyDiv = document.getElementById('blocklyDiv');
    blocklyDiv.addEventListener('mousedown', function(event){
      var isOthers = false;

      // Find encapsulating parent
      var target = event.target;
      while (!isCodeBlock(target) && !isCategory(target)) {
        target = target.parentElement;
        if (target == null) {
          isOthers = true;
          break;
        }
      }

      // Format logged data
      var element;
      if (isOthers) {
        element = event.target.classList.length ? event.target.classList[0] : event.target.localName;
      }
      else if (isCodeBlock(target)) {
        element = target.getAttribute('data-id');
        lastClickedBlock = element;
      }
      else {
        element = target.classList[1];
      }
      var x = event.clientX;
      var y = event.clientY;
      var date = new Date();
      var data = [step++, element, x, y, date, event.target];
      actions.push(data);

      totalClicks++;
    }, true);

    // Identify "gibberish" unique identifier to readable block names
    var blocksID = {};
    blocklyDiv.addEventListener('mouseup', function(event){

      // Find encapsulating parent
      var target = event.target;
      while (!isCodeBlock(target)) {
        target = target.parentElement;
        if (target == null) {
          return;
        }
      }

      // Map unique identifier to unique block name
      var uniqueIdentifier = target.getAttribute('data-id');
      if (!(uniqueIdentifier in blocksID) && uniqueIdentifier != lastClickedBlock) {
        blocksID[uniqueIdentifier] = lastClickedBlock;
      }
    }, true);
  </script>
</html>
